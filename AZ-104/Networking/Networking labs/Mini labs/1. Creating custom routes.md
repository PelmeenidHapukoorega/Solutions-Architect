# Mini lab 1: Creating custom routes

Here i created route table, custom route and subnets. Then i associated the route table with the subnets to further my understanding on how it all works and how is it beneficial.

1. Created resource group:
```bash
az group create --name customroutestest --location norwayeast
```

Output:

<img width="792" height="268" alt="image" src="https://github.com/user-attachments/assets/6b8b0233-8649-4cae-a3b7-349f82471c16" />

2. Then i created route table in the resource group:
```bash
az network route-table create \
--name publictable \
--resource-group customroutestest \
--disable-bgp-route-propagation false
```

Output:

<img width="939" height="347" alt="image" src="https://github.com/user-attachments/assets/e0f1f9dd-667e-4380-9e16-3da2dd343127" />

I used `--disable-bgp-route-propagation false` so that route table would accept and use routes learned dynamically from BGP peers.

If the statement were set to `true` it would block BGP routes from entering the route table and only the static UDRs would apply.

3. Next i created custom route with hop type and next hops IP address:
```bash
az network route-table route create \
--route-table-name publictable \
--resource-group customroutestest \
--name productionsubnet \
--address-prefix 10.0.1.0/24 \
--next-hop-type VirtualAppliance \
--next-hop-ip-address 10.0.2.4
```

Output:

<img width="939" height="398" alt="image" src="https://github.com/user-attachments/assets/15c38672-cce6-4e6b-9e1f-c2cec81ee6ee" />

## Creating VNets and subnets

I needed to create 3 subnets: publicsubnet, privatesubnet and dmzsubnet

1. VNet and Publicsubnet creation:
```bash
az network vnet create \
--name vnet \
--resource-group customroutestest \
--address-prefixes 10.0.0.0/16 \
--subnet-name publicsubnet \
--subnet-prefixes 10.0.0.0/24
```

2. Privatesubnet creation:
```bash
az network vnet subnet create \
--name privatesubnet \
--vnet-name vnet \
--resource-group customroutestest \
--address-prefixes 10.0.1.0/24
```

3. Created dmzsubnet:
```bash
az network vnet subnet create \
--name dmzsubnet \
--vnet-name vnet \
--resource-group "customroutestest" \
--address-prefixes 10.0.2.0/24
```

4. Ran VNet subnet list to confirm that all 3 subnets now existed in the VNet:
```bash
az network vnet subnet list \
--resource-group customroutestest \
--vnet-name vnet \
--output table
```

Output:

<img width="942" height="287" alt="image" src="https://github.com/user-attachments/assets/920bd10b-f2a3-4af8-aaf5-6073de164b4e" />

## Associating route table with public subnet

Associated the route table with public subnet to force outbound traffic through NVA.
``` bash
az network vnet subnet update \
--name publicsubnet \
--vnet-name vnet \
--resource-group customroutestest \
--route-table publictable
```

Output:

<img width="944" height="455" alt="image" src="https://github.com/user-attachments/assets/f62aa3da-17a0-4adc-8fa4-bf0e74a8ca31" />

**Note**

Route table is associated only when you want to change how the specific subnet routes outbound traffic.

Performed cleanup:
```bash
az group delete --name customroutestest
```

## Summary

For this lab i wanted to move away from Azures default routing and manually control how traffic flows between my subnets. I started by spinning up a Route Table using the Azure CLI and made sure to keep BGP propagation on so it could handle dynamic routes if needed.

The big move here was adding a custom route that forced any traffic headed for the private subnet (`10.0.1.0/24`) to go to a specific "Next Hop" IP address (`10.0.2.4`) which represents an NVA or firewall in my DMZ.

After i built the VNet and the 3 different subnets (public, private, and DMZ), the final step was associating my Route Table with the publicsubnet. This basically told that specific subnet: "dont follow the default rules: use my custom table instead." This setup is exactly how you would force traffic through a security appliance before its allowed to reach sensitive data.

## What i learned

* Default vs. Custom: Azure lets subnets talk to each other automatically but you have to use a Route Table if you want to break that and force traffic through a middleman like an NVA.
* The Next Hop: Learned that setting the `NextHopType` to `VirtualAppliance` and giving it a private IP is the standard way to set up a firewall path.
* BGP Propagation: Setting this to `false` would lock down the table to only my manual rules, but keeping it `true` lets the table learn routes from other gateways automatically.
* Association is Key: Simply creating a Route Table doesnt do anything until you actually attach or associate it to a specific subnet.
* CLI Efficiency: Its way faster to use `az network vnet subnet update` to link tables than clicking through several layers of the portal UI. Using CLI over pwsh feels much more efficient anyway because there is less importance on letter capitalization.
* Traffic Scrubbing: This lab showed me the basics of "service chaining" > directing traffic through a DMZ before it gets to the private backend.
